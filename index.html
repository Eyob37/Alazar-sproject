<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Trader Notebook</title>
    <style>
        body {
            background: orange;            
        }
        h1 {
            color: blue;
            text-align: center;
        }
        table {            
            border-collapse: collapse;
            width: 95%;
            text-align: center;
            margin: 50px auto;   
            background: #afafaf;   
            box-shadow: 10px 10px 10px gold;    
            table-layout: fixed;  
        }        
        table, th, tr, td {            
            font-size: 12px;
            padding: 5px;
            border: 1px solid black;
        }                        

        th:nth-child(2), td:nth-child(2), 
        th:nth-child(3), td:nth-child(3) {
            width: 30%;
        }

        th:nth-child(1), td:nth-child(1),
        th:nth-child(4), td:nth-child(4),
        th:nth-child(5), td:nth-child(5),
        th:nth-child(6), td:nth-child(6) {
            width: 10%;
        }
        button {
            color: red;
            width: 80%;
            height: auto;            
            font-size: 90%;
            font-weight: 600;
            background: cyan;
            border: none;
            cursor: pointer;
        }
        #add {  
            color: red;  
            position: fixed;  
            right: 1%;  
            bottom: 1%;  
            width: 50px;  
            height: 50px;  
            font-size: 45px;  
            border-radius: 50%;  
            font-weight: 600;  
            background: cyan;  
        }  
        img {
            max-width: 100%;
            height: auto;
        }        
    </style>
</head>
<body>
    <h1>Note Books for Traders</h1>
    <table id="dataTable">
        <tr>
            <th>Trade</th>
            <th>Reason</th>          
            <th>Picture</th>
            <th>Risk to Reward</th>
            <th>Risk Reward Ratio</th>
            <th>Action</th>
        </tr>
    </table>
    <button id="add" onclick="add()">+</button>

    <script>
        const table = document.getElementById('dataTable');        

        function loadTable() {
            const savedData = JSON.parse(localStorage.getItem('tableData')) || [];
            savedData.forEach(data => insertRow(data));
        }

        function saveTable() {
            const rows = Array.from(table.rows).slice(1);
            const tableData = rows.map(row => ({
                id: row.id,
                trade: row.cells[0].innerText,
                reason: row.cells[1].innerText,
                fileData: row.cells[2].querySelector("img")?.src || '',
                riskToReward: row.cells[3].innerText,
                riskRewardRatio: row.cells[4].innerText
            }));
            localStorage.setItem('tableData', JSON.stringify(tableData));
        }

        function insertRow(data) {
            const newRow = table.insertRow();
            newRow.id = data.id || `row-${Date.now()}`;
            newRow.insertCell(0).innerText = data.trade;
            newRow.insertCell(1).innerText = data.reason;

            const imgCell = newRow.insertCell(2);
            if (data.fileData) {
                const img = document.createElement("img");
                img.src = data.fileData;
                imgCell.appendChild(img);
            } else {
                imgCell.innerText = "No Image";
            }
            
            newRow.insertCell(3).innerText = data.riskToReward;
            newRow.insertCell(4).innerText = data.riskRewardRatio;

            const actionCell = newRow.insertCell(5);
            const deleteButton = document.createElement("button");
            deleteButton.innerText = "X";
            deleteButton.onclick = function() { removeRow(newRow.id); };
            actionCell.appendChild(deleteButton);

            saveTable();
        }

        function removeRow(rowId) {
            const row = document.getElementById(rowId);
            if (row) {
                row.remove();
                saveTable();
            }
        }

        window.onload = function() {
            loadTable();
            const trade = sessionStorage.getItem('trade');
            const reason = sessionStorage.getItem('reason');
            const fileData = sessionStorage.getItem('file');
            const riskToReward = JSON.parse(sessionStorage.getItem('riskToReward'));
            const riskRewardRatio = JSON.parse(sessionStorage.getItem('riskRewardRatio'));

            if (trade && reason && riskToReward && riskRewardRatio) {
                insertRow({
                    id: `row-${Date.now()}`,
                    trade,
                    reason,
                    fileData,
                    riskToReward: `${riskToReward.risk} : ${riskToReward.reward}`,
                    riskRewardRatio: `${riskRewardRatio.risk} : ${riskRewardRatio.reward}`
                });
                sessionStorage.clear();
            }
        };

        function add() {
            window.location.href = "Next.html";
        }
    </script>
</body>
</html>
